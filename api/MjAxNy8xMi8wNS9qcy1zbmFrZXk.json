{"title":"手起刀落-一起写经典的贪吃蛇游戏","date":"2017-12-05T15:30:00.000Z","date_formatted":{"ll":"Dec 5, 2017","L":"12/05/2017","MM-DD":"12-05"},"link":"2017/12/05/js-snakey","tags":["Canvas","JS","小游戏"],"categories":["JavaScript"],"updated":"2018-09-21T10:08:19.000Z","content":"<h1 id=\"回味\">回味<a href=\"2017/12/05/js-snakey#回味\"></a></h1><p>小时候玩的经典贪吃蛇游戏我们印象仍然深刻，谋划了几天，小时候喜欢玩的游戏，长大了终于有能力把他做出来(从来都没有通关过，不知道自己写的程序，是不是能通关了…)，好了，闲话不多谈，先来看一下效果吧！！</p>\n<p><img src=\"http://www.chenqaq.com/assets/images/4tjOY7QXHK.gif\" alt=\"效果图\" class=\"article-img\"></p>\n<p>功能和小时候玩的贪吃蛇一样，</p>\n<blockquote>\n<p>   1.选择速度 ：<br>       slow<br>       normal<br>       fast</p>\n</blockquote>\n<blockquote>\n<p>   2.选择是否有墙作为障碍物：<br>       on<br>       off</p>\n</blockquote>\n<p>看完效果就先附上地址喽：<a href=\"https://github.com/okaychen/practice\" target=\"_blank\" rel=\"noopener\">大山深处修炼的小龙虾</a>，欢迎fork.</p>\n<a id=\"more\"></a>\n<h1 id=\"结构分解\">结构分解<a href=\"2017/12/05/js-snakey#结构分解\"></a></h1><p>如果构建一个简单的经典贪吃蛇游戏呢？我们根据面板可以分解出如下结构：</p>\n<p><img src=\"http://www.chenqaq.com/assets/images/snake1.png\" alt=\"面板结构分解\" class=\"article-img\"></p>\n<p>因为其他面板比较简单，我们重点来看一下游戏面板</p>\n<h2 id=\"游戏面板\">游戏面板<a href=\"2017/12/05/js-snakey#游戏面板\"></a></h2><p>游戏面板是核心，在游戏面板中，我们来分解一下游戏面板我们需要的因素：</p>\n<p><img src=\"http://www.chenqaq.com/assets/images/snake2.png\" alt class=\"article-img\"></p>\n<h3 id=\"场景、snake、食物\">场景、snake、食物<a href=\"2017/12/05/js-snakey#场景、snake、食物\"></a></h3><p>首先我们需要一个游戏场景、snake、食物这些基础设施<br>   这里使用canvas作为我们的整个游戏的场景：</p>\n<figure class=\"highlight\"><div><table><tr><td class=\"code\"><pre><span class=\"line\">&lt;canvas <span class=\"keyword\">class</span>=\"<span class=\"symbol\">wrap</span>\" <span class=\"symbol\">id</span>=\"<span class=\"symbol\">snake</span>\" <span class=\"symbol\">width</span>=\"<span class=\"symbol\">400</span>\" <span class=\"symbol\">height</span>=\"<span class=\"symbol\">400</span>\" <span class=\"symbol\">tabindex</span>=\"<span class=\"symbol\">1</span>\"&gt;&lt;/<span class=\"symbol\">canvas</span>&gt;</span><br></pre></td></tr></table></div></figure>\n<p>需要一只snake,后面初始化他的位置</p>\n<figure class=\"highlight\"><div><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keywords\">var</span> activeDot = function (<span class=\"symbol\">x</span>, <span class=\"symbol\">y</span>) &#123;</span><br><span class=\"line\">    ctx.fillStyle = <span class=\"string\">\"#eee\"</span>;</span><br><span class=\"line\">    ctx.fillRect(<span class=\"symbol\">x</span> * <span class=\"number\">10</span>, <span class=\"symbol\">y</span> * <span class=\"number\">10</span>, <span class=\"number\">10</span>, <span class=\"number\">10</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></div></figure>\n<p>需要食物作为对象(关于食物我们需要定义一些规则，如食物的产生)</p>\n<figure class=\"highlight\"><div><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">var</span> <span class=\"string\">food</span> <span class=\"string\">=</span> <span class=\"string\">&#123;</span></span><br><span class=\"line\">    <span class=\"attr\">x:</span> <span class=\"number\">0</span><span class=\"string\">,</span></span><br><span class=\"line\">    <span class=\"attr\">y:</span> <span class=\"number\">0</span></span><br><span class=\"line\"><span class=\"string\">&#125;;</span></span><br></pre></td></tr></table></div></figure>\n<h3 id=\"规则\">规则<a href=\"2017/12/05/js-snakey#规则\"></a></h3><p>规则是游戏的核心</p>\n<p>关于游戏的规则</p>\n<p>snake的方向控制：(使用键盘的上下左右键控制蛇的方向)</p>\n<figure class=\"highlight\"><div><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// changer dir</span></span><br><span class=\"line\">   <span class=\"keyword\">var</span> changeDir = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">key</span>) </span>&#123;</span><br><span class=\"line\">       <span class=\"keyword\">if</span> (key == <span class=\"number\">38</span> &amp;&amp; snake_dir != <span class=\"number\">2</span>) &#123;</span><br><span class=\"line\">           snake_next_dir = <span class=\"number\">0</span>;</span><br><span class=\"line\">       &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">           <span class=\"keyword\">if</span> (key == <span class=\"number\">39</span> &amp;&amp; snake_dir != <span class=\"number\">3</span>) &#123;</span><br><span class=\"line\">               snake_next_dir = <span class=\"number\">1</span>;</span><br><span class=\"line\">           &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">               <span class=\"keyword\">if</span> (key == <span class=\"number\">40</span> &amp;&amp; snake_dir != <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">                   snake_next_dir = <span class=\"number\">2</span>;</span><br><span class=\"line\">               &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                   <span class=\"keyword\">if</span> (key == <span class=\"number\">37</span> &amp;&amp; snake_dir != <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">                       snake_next_dir = <span class=\"number\">3</span>;</span><br><span class=\"line\">                   &#125;</span><br><span class=\"line\">               &#125;</span><br><span class=\"line\">           &#125;</span><br><span class=\"line\">       &#125;</span><br><span class=\"line\">   &#125;</span><br></pre></td></tr></table></div></figure>\n<p>关于食物，如果食物被吃掉，我们就需要产生新的食物</p>\n<figure class=\"highlight\"><div><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// add food</span></span><br><span class=\"line\">  <span class=\"keyword\">var</span> addFood = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">      food.x = <span class=\"built_in\">Math</span>.floor(<span class=\"built_in\">Math</span>.random() * ((canvas.width / <span class=\"number\">10</span>) - <span class=\"number\">1</span>));</span><br><span class=\"line\">      food.y = <span class=\"built_in\">Math</span>.floor(<span class=\"built_in\">Math</span>.random() * ((canvas.height / <span class=\"number\">10</span>) - <span class=\"number\">1</span>));</span><br><span class=\"line\">      <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>; i &lt; snake.length; i++) &#123;</span><br><span class=\"line\">          <span class=\"comment\">// 如果食物被吃就增加食物</span></span><br><span class=\"line\">          <span class=\"keyword\">if</span> (checkBlock(food.x, food.y, snake[i].x, snake[i].y)) &#123;</span><br><span class=\"line\">              addFood();</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">var</span> checkBlock = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">x, y, _x, _y</span>) </span>&#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> (x == _x &amp;&amp; y == _y) ? <span class=\"literal\">true</span> : <span class=\"literal\">false</span>;</span><br><span class=\"line\">  &#125;</span><br></pre></td></tr></table></div></figure>\n<p>接下来是核心的函数，根据选择的速度和是否有墙体作为障碍物的设置，让蛇运动起来，并且实现</p>\n<blockquote>\n<p>  1、根据选择slow、norma、fast决定蛇运动速度速度;</p>\n</blockquote>\n<blockquote>\n<p>  2、如果蛇碰到自己==自杀，游戏结束</p>\n</blockquote>\n<blockquote>\n<p>  3、有墙模式碰到墙体，游戏结束</p>\n</blockquote>\n<blockquote>\n<p>   4、无墙模式蛇穿过墙体，从另一侧出现</p>\n</blockquote>\n<blockquote>\n<p>   5、使蛇碰到食物就加入自身身体的一部分，执行增加食物函数</p>\n</blockquote>\n<figure class=\"highlight\"><div><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> mainLoop = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">       <span class=\"keyword\">var</span> _x = snake[<span class=\"number\">0</span>].x;</span><br><span class=\"line\">       <span class=\"keyword\">var</span> _y = snake[<span class=\"number\">0</span>].y;</span><br><span class=\"line\">       snake_dir = snake_next_dir;</span><br><span class=\"line\">       <span class=\"comment\">//  0 — up  1 — right   2 — down  3 — left</span></span><br><span class=\"line\">       <span class=\"keyword\">switch</span> (snake_dir) &#123;</span><br><span class=\"line\">           <span class=\"keyword\">case</span> <span class=\"number\">0</span>:</span><br><span class=\"line\">               _y--;</span><br><span class=\"line\">               <span class=\"keyword\">break</span>;</span><br><span class=\"line\">           <span class=\"keyword\">case</span> <span class=\"number\">1</span>:</span><br><span class=\"line\">               _x++;</span><br><span class=\"line\">               <span class=\"keyword\">break</span>;</span><br><span class=\"line\">           <span class=\"keyword\">case</span> <span class=\"number\">2</span>:</span><br><span class=\"line\">               _y++;</span><br><span class=\"line\">               <span class=\"keyword\">break</span>;</span><br><span class=\"line\">           <span class=\"keyword\">case</span> <span class=\"number\">3</span>:</span><br><span class=\"line\">               _x--;</span><br><span class=\"line\">               <span class=\"keyword\">break</span>;</span><br><span class=\"line\">       &#125;</span><br><span class=\"line\">       snake.pop();</span><br><span class=\"line\">       snake.unshift(&#123;</span><br><span class=\"line\">           x: _x,</span><br><span class=\"line\">           y: _y</span><br><span class=\"line\">       &#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">       <span class=\"comment\">// --wall</span></span><br><span class=\"line\">       <span class=\"keyword\">if</span> (wall == <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">           <span class=\"keyword\">if</span> (snake[<span class=\"number\">0</span>].x &lt; <span class=\"number\">0</span> || snake[<span class=\"number\">0</span>].x == canvas.width / <span class=\"number\">10</span> || snake[<span class=\"number\">0</span>].y &lt; <span class=\"number\">0</span> || snake[<span class=\"number\">0</span>].y == canvas.height / <span class=\"number\">10</span>) &#123;</span><br><span class=\"line\">               showScreen(<span class=\"number\">3</span>);</span><br><span class=\"line\">               <span class=\"keyword\">return</span>;</span><br><span class=\"line\">           &#125;</span><br><span class=\"line\">       &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">           <span class=\"comment\">//  off 无墙</span></span><br><span class=\"line\">           <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>, x = snake.length; i &lt; x; i++) &#123;</span><br><span class=\"line\">               <span class=\"keyword\">if</span> (snake[i].x &lt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">                   snake[i].x = snake[i].x + (canvas.width / <span class=\"number\">10</span>);</span><br><span class=\"line\">               &#125;</span><br><span class=\"line\">               <span class=\"keyword\">if</span> (snake[i].x == canvas.width / <span class=\"number\">10</span>) &#123;</span><br><span class=\"line\">                   snake[i].x = snake[i].x - (canvas.width / <span class=\"number\">10</span>);</span><br><span class=\"line\">               &#125;</span><br><span class=\"line\">               <span class=\"keyword\">if</span> (snake[i].y &lt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">                   snake[i].y = snake[i].y + (canvas.height / <span class=\"number\">10</span>);</span><br><span class=\"line\">               &#125;</span><br><span class=\"line\">               <span class=\"keyword\">if</span> (snake[i].y == canvas.height / <span class=\"number\">10</span>) &#123;</span><br><span class=\"line\">                   snake[i].y = snake[i].y - (canvas.height / <span class=\"number\">10</span>);</span><br><span class=\"line\">               &#125;</span><br><span class=\"line\">           &#125;</span><br><span class=\"line\">       &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">       <span class=\"comment\">//  Autophagy death</span></span><br><span class=\"line\">       <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">1</span>; i &lt; snake.length; i++) &#123;</span><br><span class=\"line\">           <span class=\"keyword\">if</span> (snake[<span class=\"number\">0</span>].x == snake[i].x &amp;&amp; snake[<span class=\"number\">0</span>].y == snake[i].y) &#123;</span><br><span class=\"line\">               showScreen(<span class=\"number\">3</span>);</span><br><span class=\"line\">               <span class=\"keyword\">return</span>;</span><br><span class=\"line\">           &#125;</span><br><span class=\"line\">       &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">       <span class=\"comment\">// Eat food</span></span><br><span class=\"line\">       <span class=\"keyword\">if</span> (checkBlock(snake[<span class=\"number\">0</span>].x, snake[<span class=\"number\">0</span>].y, food.x, food.y)) &#123;</span><br><span class=\"line\">           snake[snake.length] = &#123;</span><br><span class=\"line\">               x: snake[<span class=\"number\">0</span>].x,</span><br><span class=\"line\">               y: snake[<span class=\"number\">0</span>].y</span><br><span class=\"line\">           &#125;;</span><br><span class=\"line\">           score += <span class=\"number\">1</span>;</span><br><span class=\"line\">           altScore(score);</span><br><span class=\"line\">           addFood();</span><br><span class=\"line\">           activeDot(food.x, food.y);</span><br><span class=\"line\">       &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">       <span class=\"comment\">// --------------------</span></span><br><span class=\"line\"></span><br><span class=\"line\">       ctx.beginPath();</span><br><span class=\"line\">       ctx.fillStyle = <span class=\"string\">\"#111\"</span>;</span><br><span class=\"line\">       ctx.fillRect(<span class=\"number\">0</span>, <span class=\"number\">0</span>, canvas.width, canvas.height);</span><br><span class=\"line\"></span><br><span class=\"line\">       <span class=\"comment\">// --------------------</span></span><br><span class=\"line\"></span><br><span class=\"line\">       <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>; i &lt; snake.length; i++) &#123;</span><br><span class=\"line\">           activeDot(snake[i].x, snake[i].y);</span><br><span class=\"line\">       &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">       <span class=\"comment\">// --------------------</span></span><br><span class=\"line\"></span><br><span class=\"line\">       activeDot(food.x, food.y);</span><br><span class=\"line\"></span><br><span class=\"line\">       setTimeout(mainLoop, snake_speed);</span><br><span class=\"line\">   &#125;</span><br></pre></td></tr></table></div></figure>\n\n<p>ok以上展示出一些核心部分，构建出一个舞台中一只小蛇的故事.</p>\n<p><video controls src=\"http://gslb.miaopai.com/stream/9Sve8-3osRBmmpEvONt~uKP-WbvOSRLH.mp4?ssig=3a4333a30009844032269e50b9be79b7&time_stamp=1512196508068&cookie_id=&vend=1&os=3&partner=1&platform=2&cookie_id=&refer=miaopai&scid=9Sve8-3osRBmmpEvONt%7EuKP-WbvOSRLH\" loop=\"false\" width=\"100%\" height=\"420\">embed: cat.mov</video></p>\n<p>小时候爸妈手机里有一款小游戏叫贪吃蛇。就是一条小蛇，不停地在屏幕上游走，吃各个方向出现的食物，越吃越长。只要蛇头碰到屏幕四周，或者碰到自己的身子，小蛇就立即毙命。方寸的舞台间，亦有无限精彩；</p>\n<p>PS:到现在也没有通关过..现在不知道能不能通关了…</p>\n<p>最后在附上次源码，欢迎fork交流：<a href=\"https://github.com/okaychen/practice\" target=\"_blank\" rel=\"noopener\">https://github.com/okaychen/practice</a>…<br>因为自己测试用的服务器被占用，目前只有做的效果图供大家参考喽.</p>\n","prev":{"title":"同步、异步、回调执行顺序经典闭包setTimeout分析","link":"2017/12/06/js-setTimeout"},"plink":"//litten.me/2017/12/05/js-snakey/","toc":[{"title":"回味","id":"回味","index":"1"},{"title":"结构分解","id":"结构分解","index":"2","children":[{"title":"游戏面板","id":"游戏面板","index":"2.1","children":[{"title":"场景、snake、食物","id":"场景、snake、食物","index":"2.1.1"},{"title":"规则","id":"规则","index":"2.1.2"}]}]}],"copyright":{"custom":"自由转载-非商用-禁止演绎-保持署名（CC BY-NC-ND 4.0）"}}